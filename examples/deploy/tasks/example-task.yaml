apiVersion: fabric.jarsater.ai/v1alpha1
kind: Task
metadata:
  name: example-task
  namespace: mcp-fabric-agents
spec:
  # Reference to the worker agent that implements tasks
  workerRef:
    name: code-worker
    namespace: mcp-fabric-agents

  # Reference to the orchestrator agent (optional - defaults to task-orchestrator)
  orchestratorRef:
    name: task-orchestrator
    namespace: mcp-fabric-agents

  # Load PRD from ConfigMap
  taskSource:
    type: configmap
    configMapRef:
      name: example-prd
      key: prd.json

  # Git configuration for cloning and pushing changes
  # The repository is cloned in an init container before the orchestrator runs
  git:
    # URL of the repository to clone (required)
    url: https://github.com/example/my-project.git
    # Branch to work on (default: main)
    branch: feat/task-example
    # Create feature branch from this base branch (optional)
    baseBranch: main
    # Shallow clone depth (default: 1, use 0 for full clone)
    depth: 1
    # Secret containing the git token (required key: "token")
    credentialsSecret:
      name: github-credentials
    # Commit author settings
    commitAuthor: "MCP Fabric Task"
    commitEmail: "task@mcp-fabric.local"
    # Push and PR settings (all default to true)
    autoPush: true
    createPR: true
    draftPR: true
    # Optional PR customization
    prTitle: "feat: Automated task implementation"
    prBody: |
      ## Summary
      This PR was automatically generated by MCP Fabric Task.

      **Task:** {task}
      **Progress:** {completed}/{total} tasks completed

      ## Changes
      See individual commits for details.

  # Quality gates run after each task (optional)
  qualityGates:
    - name: lint
      command: ["npm", "run", "lint"]
      failurePolicy: Fail
      timeout: 5m
    - name: test
      command: ["npm", "test"]
      failurePolicy: Fail
      timeout: 10m

  # Execution limits
  limits:
    maxIterations: 50
    iterationTimeout: 30m
    totalTimeout: 4h
    maxConsecutiveFailures: 3

  # Additional context for the orchestrator
  context: |
    This is an example task that demonstrates the full Task feature.
    The orchestrator will dispatch tasks to the worker agent.
    Git changes are committed and pushed automatically on completion.

  paused: false
